<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Alpha — Line 1 & Line 2</title>
<style>
  :root{
    --card:rgba(15,15,25,.78);
    --border:rgba(255,255,255,.12);
    --text:#e8f0ff;
    --muted:#a5b4fc;
    --accent1:#7c3aed; /* purple */
    --accent2:#06b6d4; /* cyan */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    background:#0a0a12;color:var(--text);overflow-x:hidden
  }
  .bg{position:fixed;inset:0;z-index:-3;background:
    radial-gradient(1200px 700px at 20% -10%, #0ea5e9 0%, transparent 60%),
    radial-gradient(1000px 600px at 80% 110%, #a78bfa 0%, transparent 60%),
    linear-gradient(135deg,#0b1220,#0a0a12 40%,#0b1326);
    animation:shift 18s ease-in-out infinite alternate}
  @keyframes shift{to{background-position:50px -40px,-60px 30px,0 0}}
  canvas#glitter{position:fixed;inset:0;z-index:-2;pointer-events:none;opacity:.45}

  .container{max-width:1100px;margin:24px auto;padding:16px}
  .brand{display:flex;align-items:center;gap:14px;margin-bottom:10px}
  .alpha-logo{height:72px;width:72px;object-fit:contain}
  h1{margin:0;text-shadow:0 0 10px rgba(124,58,237,.35);font-size:24px}

  .tabs{display:flex;gap:10px;margin:14px 0 20px;flex-wrap:wrap}
  .tab-btn{
    border:1px solid var(--border);background:rgba(255,255,255,.04);color:#c7d2fe;
    border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer
  }
  .tab-btn.active{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;border-color:transparent;box-shadow:0 0 20px rgba(124,58,237,.35)}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin:8px 0 14px}
  .btn{border:1px solid rgba(255,255,255,.18);background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
  .note{font-size:12px;color:#c7d2fe}

  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;backdrop-filter:blur(12px);margin-bottom:16px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
  .col-2{grid-column:span 2}.col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
  label{display:block;font-size:12px;color:var(--muted);margin:6px 0 4px}
  input,select,textarea{
    width:100%;border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:14px;
    background:#0f1322;color:var(--text);outline:none
  }
  select, option{background:#0b0f1a;color:#e8f0ff}
  textarea{min-height:90px;resize:vertical}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border:1px solid var(--border);padding:8px;font-size:13px}
  .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px dashed var(--border);border-radius:999px;font-size:12px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="bg"></div><canvas id="glitter"></canvas>

<div class="container">
  <div class="brand">
    <!-- Replace src with your real logo file OR base64; for now it's a placeholder circle -->
    <img class="alpha-logo" src="data:image/svg+xml;utf8,
      <svg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'>
        <defs><radialGradient id='g' cx='50%' cy='50%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%2306b6d4'/></radialGradient></defs>
        <circle cx='48' cy='48' r='40' fill='url(%23g)'/></svg>" alt="Alpha"/>
    <h1>Alpha — Client Forms</h1>
  </div>

  <div class="tabs">
    <button class="tab-btn active" data-tab="line1">Line 1 (Google Sheet)</button>
    <button class="tab-btn" data-tab="line2">Line 2 (PDF Only)</button>
  </div>

  <!-- ===================== LINE 1 (Sheets) ===================== -->
  <section id="line1" class="tab-panel">
    <div class="toolbar">
      <button class="btn ghost" id="l1-saveDraft">Save Draft</button>
      <button class="btn ghost" id="l1-loadDraft">Load Draft</button>
      <span class="note">Saves locally on this device</span>
    </div>

    <form id="line1Form">
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Line 1 — Player Details</h3>
        <div class="grid">
          <div class="col-3">
            <label>Player ID (A01–A20) *</label>
            <select name="playerId" id="l1-playerId" required>
              <option value="">Select</option>
            </select>
          </div>
          <div class="col-6"><label>Player Name *</label><input name="playerName" required/></div>
          <div class="col-3"><label>Language</label>
            <select name="language"><option value="">Select</option><option>Hindi</option><option>English</option><option>Telugu</option><option>Gujarati</option><option>Other</option></select>
          </div>

          <div class="col-6"><label>Customer Name</label><input name="customerName"/></div>
          <div class="col-3"><label>Phone Number</label><input name="phone" inputmode="numeric"/></div>
          <div class="col-3"><label>Gender</label>
            <select name="gender"><option value="">Select</option><option>Male</option><option>Female</option><option>Other</option></select>
          </div>

          <div class="col-4"><label>Age</label><input type="number" min="0" name="age"/></div>
          <div class="col-4"><label>Location</label><input name="location"/></div>
          <div class="col-4"><label>Profession</label>
            <select name="profession">
              <option value="">Select</option>
              <option>Daily Labor</option>
              <option>Security Guard</option>
              <option>Driver</option>
              <option>Shopkeeper</option>
              <option>Delivery Partner</option>
              <option>Electrician</option>
              <option>Plumber</option>
              <option>Mechanic</option>
              <option>Farmer</option>
              <option>Teacher</option>
              <option>Nurse</option>
              <option>Accountant</option>
              <option>Sales Executive</option>
              <option>Graphic Designer</option>
              <option>Software Engineer</option>
              <option>Businessman</option>
              <option>Doctor</option>
              <option>Lawyer</option>
              <option>Government Employee</option>
              <option>Retired</option>
            </select>
          </div>

          <div class="col-12"><label>Remarks</label><textarea name="remarks" placeholder="cooperative / busy / follow-up etc."></textarea></div>
        </div>
      </div>

      <div class="grid">
        <div class="col-12" id="l1-status"></div>
        <div class="col-12" style="display:flex;justify-content:flex-end;gap:10px">
          <button class="btn" type="submit">Submit to Google Sheet</button>
        </div>
      </div>
    </form>
  </section>

  <!-- ===================== LINE 2 (PDF Only) ===================== -->
  <section id="line2" class="tab-panel hidden">
    <div class="toolbar">
      <button class="btn ghost" id="l2-saveDraft">Save Draft</button>
      <button class="btn ghost" id="l2-loadDraft">Load Draft</button>
      <button class="btn" id="l2-downloadPdf">Download PDF</button>
    </div>

    <form id="line2Form">
      <!-- Client Information -->
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Client Information</h3>
        <div class="grid">
          <div class="col-6"><label>Client Name *</label><input name="clientName" required/></div>
          <div class="col-3"><label>Date</label><input type="date" name="date"/></div>
          <div class="col-3"><label>Time</label><input type="time" name="time"/></div>

          <div class="col-3"><label>Language</label>
            <select name="language"><option value="">Select</option><option>English</option><option>Hindi</option><option>Gujarati</option><option>Other</option></select>
          </div>
          <div class="col-4"><label>Line 1</label>
            <select id="l2-line1" name="line1"><option value="">Select</option></select>
          </div>
          <div class="col-4"><label>Line 2</label>
            <select id="l2-line2" name="line2"><option value="">Select</option></select>
          </div>
          <div class="col-4"><label>Line 3</label>
            <select name="line3"><option value="">Select</option><option>C1</option><option>C2</option></select>
          </div>

          <div class="col-3"><label>Charging (%)</label><input type="number" min="0" max="100" name="charging"/></div>
          <div class="col-3"><label>Plugin</label><input name="plugin"/></div>
          <div class="col-6"><label>Current Location</label>
            <select name="currentLocation"><option value="">Select</option><option>Home</option><option>Office</option><option>Work</option><option>Friend</option><option>Other</option></select>
          </div>

          <div class="col-3"><label>Third Party (Y/N)</label><select name="thirdParty"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Client DOB</label><input type="date" name="dob"/></div>
          <div class="col-3"><label>Client Age</label><input type="number" min="0" name="age"/></div>
          <div class="col-3"><label>Aadhaar Number</label><input name="aadhaar"/></div>

          <div class="col-3"><label>Gender</label><select name="gender"><option value=""></option><option>Male</option><option>Female</option><option>Other</option></select></div>
          <div class="col-3"><label>Marriage (Y/N)</label><select name="marriage"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Kids (0–5)</label><select name="kids"><option value=""></option><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select></div>
          <div class="col-3"><label>Date of Marriage</label><input type="date" name="dom"/></div>

          <div class="col-3"><label>Number (Y/N)</label><select name="numberActive"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>WhatsApp (Y/N)</label><select name="whatsapp"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Phone Number</label><input name="phone1"/></div>
          <div class="col-3"><label>2nd Number</label><input name="phone2"/></div>

          <div class="col-3"><label>Emergency No</label><input name="emergencyNo"/></div>
          <div class="col-6"><label>E-mail</label><input type="email" name="email"/></div>
          <div class="col-3"><label>Education</label>
            <select name="education"><option value=""></option><option>Uneducated</option><option>Higher Edu</option><option>Bachelor</option><option>Master</option><option>Doctor/PHD</option></select>
          </div>

          <div class="col-3"><label>Work (Y/N)</label><select name="workYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Position</label><input name="position"/></div>
          <div class="col-3"><label>Employment</label><select name="employment"><option value=""></option><option>Employed</option><option>Self-Employed</option><option>Student</option><option>Retired</option></select></div>
          <div class="col-3"><label>Working Since</label><input type="number" min="1900" max="2100" name="workSince"/></div>

          <div class="col-6"><label>Company Name</label><input name="companyName"/></div>
          <div class="col-12"><label>Current Address</label><input name="currentAddress"/></div>

          <div class="col-3"><label>Phone Model</label><input name="phoneModel"/></div>
          <div class="col-3"><label>Other Phone (Y/N)</label><select name="otherPhoneYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Laptop (Y/N)</label><select name="laptopYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>2-wheeler (Y/N)</label><select name="twoWheelerYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>4-wheeler (Y/N)</label><select name="fourWheelerYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Total vehicles</label><input type="number" min="0" name="totalVehicle"/></div>
          <div class="col-3"><label>Height (cm)</label><input type="number" min="0" name="height"/></div>
          <div class="col-3"><label>Weight (kg)</label><input type="number" min="0" name="weight"/></div>
          <div class="col-6"><label>Color Tone</label><select name="colorTone"><option value=""></option><option>Fair</option><option>Wheatish</option><option>Dusky</option><option>Dark</option></select></div>

          <div class="col-3"><label>Passport (Y/N)</label><select name="passportYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Voter ID (Y/N)</label><select name="voterIdYN"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Place of Birth</label><input name="pob"/></div>
          <div class="col-3"><label>Nationality</label><input name="nationality"/></div>
          <div class="col-3"><label>Visa Rejected (Y/N)</label><select name="visaRejected"><option value=""></option><option>Y</option><option>N</option></select></div>
          <div class="col-3"><label>Overstay (Y/N)</label><select name="overstayYN"><option value=""></option><option>Y</option><option>N</option></select></div>
        </div>
      </div>

      <!-- Family -->
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Family Members</h3>
        <table class="table" id="l2-family">
          <thead><tr>
            <th>Member</th><th>Age</th><th>Job</th><th>Work/School Time</th>
            <th>Home Time</th><th>Work Off</th><th>Remarks</th><th>Expected Visitors</th><th></th>
          </tr></thead><tbody></tbody>
        </table>
        <div style="margin-top:8px"><button type="button" class="btn" onclick="addRow('l2-family')">+ Add Member</button></div>
      </div>

      <!-- Daily Call Log -->
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Daily Call Log</h3>
        <table class="table" id="l2-calls">
          <thead><tr>
            <th>Relation</th><th>Time</th><th>Reason</th><th>Duration</th><th>Platform</th>
            <th>1st</th><th>2nd</th><th>3rd</th><th>4th</th><th>5th</th><th>6th</th><th></th>
          </tr></thead><tbody></tbody>
        </table>
        <div style="margin-top:8px"><button type="button" class="btn" onclick="addRow('l2-calls')">+ Add Call</button></div>
      </div>

      <!-- Bank -->
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Bank Details</h3>
        <table class="table" id="l2-banks">
          <thead><tr>
            <th>Bank Name</th><th>Single/Joint</th><th>Saving/Current</th><th>Year</th>
            <th>Purpose</th><th>Cheque Book</th><th>Passbook</th><th>Internet Banking</th>
            <th>Phone Banking</th><th>UPI</th><th>PhonePe</th><th>Google Pay</th><th>Closing Balance</th><th>Fixed Deposit</th><th></th>
          </tr></thead><tbody></tbody>
        </table>
        <div style="margin-top:8px"><button type="button" class="btn" onclick="addRow('l2-banks')">+ Add Bank</button></div>
      </div>

      <!-- Assets -->
      <div class="card">
        <h3 style="margin:4px 0 12px 0">Assets (Ask in detail)</h3>
        <div class="grid">
          <div class="col-3">
            <label><input id="asset_rd" type="checkbox"> RD</label>
            <input class="asset-amt" id="asset_rd_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_mutualFunds" type="checkbox"> Mutual Funds</label>
            <input class="asset-amt" id="asset_mutualFunds_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_shares" type="checkbox"> Shares</label>
            <input class="asset-amt" id="asset_shares_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_gold" type="checkbox"> Gold</label>
            <input class="asset-amt" id="asset_gold_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_diamond" type="checkbox"> Diamond</label>
            <input class="asset-amt" id="asset_diamond_amt" type="number" min="0" step="0.01" placeholder="Amount">
          </div>
          <div class="col-3">
            <label><input id="asset_silver" type="checkbox"> Silver</label>
            <input class="asset-amt" id="asset_silver_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_vehicle" type="checkbox"> Vehicle</label>
            <input class="asset-amt" id="asset_vehicle_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_realestate" type="checkbox"> Real estate</label>
            <input class="asset-amt" id="asset_realestate_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_cash" type="checkbox"> Cash</label>
            <input class="asset-amt" id="asset_cash_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_crypto" type="checkbox"> Crypto</label>
            <input class="asset-amt" id="asset_crypto_amt" type="number" min="0" step="0.01" placeholder="Amount">
          </div>
          <div class="col-3">
            <label><input id="asset_ppf" type="checkbox"> PPF</label>
            <input class="asset-amt" id="asset_ppf_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_pf" type="checkbox"> PF</label>
            <input class="asset-amt" id="asset_pf_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_coins" type="checkbox"> Coins</label>
            <input class="asset-amt" id="asset_coins_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_limitedBooks" type="checkbox"> Limited Books</label>
            <input class="asset-amt" id="asset_limitedBooks_amt" type="number" min="0" step="0.01" placeholder="Amount">
            <label><input id="asset_expWatches" type="checkbox"> Exp. Watches</label>
            <input class="asset-amt" id="asset_expWatches_amt" type="number" min="0" step="0.01" placeholder="Amount">
          </div>
          <div class="col-3">
            <label>Asset Notes</label>
            <textarea id="assetNotes" placeholder="Details about assets..."></textarea>
          </div>
        </div>
      </div>
    </form>

    <div class="note">This Line 2 section does not send to Google Sheets. Use “Download PDF”.</div>
  </section>
</div>

<!-- libs for Line 2 PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
/* ========= CONFIG =========
   Paste your existing Line 1 Apps Script Web App URL below */
const LINE1_SCRIPT_URL = "REPLACE_WITH_YOUR_LINE1_APPS_SCRIPT_URL"; // e.g. https://script.google.com/macros/s/AKfyc.../exec

/* ========= glitter background ========= */
(function glitter(){
  const c=document.getElementById('glitter'); const ctx=c.getContext('2d'); let w,h,stars=[];
  function resize(){ w=c.width=innerWidth; h=c.height=innerHeight; stars=Array.from({length:120},()=>spawn()); }
  function spawn(){ return {x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.8+.4,a:Math.random()*Math.PI*2,s:Math.random()*.6+.2,tw:Math.random()*.06+.02}; }
  function tick(){ ctx.clearRect(0,0,w,h); stars.forEach(s=>{ s.x+=Math.cos(s.a)*s.s; s.y+=Math.sin(s.a)*s.s;
    if(s.x<0||s.x>w||s.y<0||s.y>h) Object.assign(s,spawn(),{x:(s.x<0?w:(s.x>w?0:s.x)),y:(s.y<0?h:(s.y>h?0:s.y))});
    const g=.6+Math.sin(performance.now()*s.tw)*.4; ctx.beginPath(); ctx.fillStyle=`rgba(167,139,250,${.65*g})`; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();});
    requestAnimationFrame(tick); }
  addEventListener('resize', resize); resize(); tick();
})();

/* ========= tabs ========= */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.add('hidden'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.remove('hidden');
  });
});

/* ========= Line 1: populate Player IDs A01..A20 ========= */
(function(){
  const sel = document.getElementById('l1-playerId');
  for(let i=1;i<=20;i++) sel.add(new Option('A'+String(i).padStart(2,'0')));
})();

/* ========= Line 1: Save / Load Draft ========= */
(function(){
  const form = document.getElementById('line1Form');
  document.getElementById('l1-saveDraft').addEventListener('click', ()=>{
    const data = Object.fromEntries(new FormData(form).entries());
    localStorage.setItem('alpha_line1_draft', JSON.stringify(data));
    alert('Line 1 draft saved on this device.');
  });
  document.getElementById('l1-loadDraft').addEventListener('click', ()=>{
    const raw = localStorage.getItem('alpha_line1_draft');
    if(!raw) return alert('No draft found.');
    const data = JSON.parse(raw);
    for (const [k,v] of Object.entries(data)) { const el = form.elements[k]; if (!el) continue; el.value = v; }
  });
})();

/* ========= Line 1: Submit to Google Sheets ========= */
document.getElementById('line1Form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const status = document.getElementById('l1-status');

  if (!LINE1_SCRIPT_URL || LINE1_SCRIPT_URL.includes('REPLACE_WITH')) {
    alert('Please set LINE1_SCRIPT_URL at the top of the file.');
    return;
  }

  const fd = new FormData(e.target);
  // helpful meta (your Apps Script can route by this)
  fd.append('whichForm', 'line1');        // lets your script know this is Line 1
  fd.append('sheet', 'line 1 data');      // optional: target sheet/tab name

  const body = new URLSearchParams(fd);
  try{
    await fetch(LINE1_SCRIPT_URL, { method:'POST', mode:'no-cors', body });
    status.innerHTML = '<div class="pill" style="border-color:#10b981;color:#065f46;background:#ecfdf5">Submitted to Google Sheet!</div>';
    e.target.reset();
  }catch(err){
    console.error(err);
    status.innerHTML = '<div class="pill" style="border-color:#ef4444;color:#991b1b;background:#fef2f2">Network error. Check connection.</div>';
  }
});

/* ========= Line 2: Select options (A01..A20 / B01..B20) ========= */
(function(){
  const l1 = document.getElementById('l2-line1');
  const l2 = document.getElementById('l2-line2');
  for (let i=1;i<=20;i++){
    l1.add(new Option('A'+String(i).padStart(2,'0')));
    l2.add(new Option('B'+String(i).padStart(2,'0')));
  }
})();

/* ========= Line 2: dynamic tables ========= */
function addRow(tableId){
  const tb = document.querySelector(`#${tableId} tbody`);
  const tr = document.createElement('tr');
  if (tableId==='l2-family'){
    tr.innerHTML = `
      <td><input></td><td><input type="number" min="0"></td><td><input></td>
      <td><input></td><td><input></td><td><input></td><td><input></td><td><input></td>
      <td><button type="button" class="btn" onclick="this.closest('tr').remove()">Remove</button></td>`;
  } else if (tableId==='l2-calls'){
    tr.innerHTML = `
      <td><input></td><td><input type="time"></td><td><input></td><td><input></td><td><input></td>
      <td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td>
      <td><button type="button" class="btn" onclick="this.closest('tr').remove()">Remove</button></td>`;
  } else if (tableId==='l2-banks'){
    tr.innerHTML = `
      <td><input></td><td><input></td><td><input></td><td><input type="number" min="1900" max="2100"></td>
      <td><input></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td>
      <td><input></td><td><input></td><td><input></td><td><input></td>
      <td><button type="button" class="btn" onclick="this.closest('tr').remove()">Remove</button></td>`;
  }
  tb.appendChild(tr);
}
// seed one empty row each
['l2-family','l2-calls','l2-banks'].forEach(id=>addRow(id));

/* ========= Line 2: Save/Load draft ========= */
(function(){
  const form = document.getElementById('line2Form');
  document.getElementById('l2-saveDraft').addEventListener('click', ()=>{
    const base = Object.fromEntries(new FormData(form).entries());
    function tableToArray(id, keys){
      const rows=[]; document.querySelectorAll(`#${id} tbody tr`).forEach(tr=>{
        const inp = tr.querySelectorAll('input,select,textarea'); const o={};
        keys.forEach((k,i)=>o[k]=inp[i]?inp[i].value:''); rows.push(o);
      }); return rows;
    }
    const draft = {
      base,
      fam: tableToArray('l2-family',['member','age','job','workTime','homeTime','workOff','remarks','expectedVisitors']),
      calls: tableToArray('l2-calls',['relation','time','reason','duration','platform','c1','c2','c3','c4','c5','c6']),
      banks: tableToArray('l2-banks',['name','singleJoint','type','year','purpose','cheque','passbook','internet','phone','upi','phonepe','gpay','closing','fd']),
      assets: (()=>{ const ks=['rd','mutualFunds','shares','gold','diamond','silver','vehicle','realestate','cash','crypto','ppf','pf','coins','limitedBooks','expWatches'];
        const obj={}; ks.forEach(k=>{ const chk=document.getElementById('asset_'+k); const amt=document.getElementById('asset_'+k+'_amt');
          if(chk||amt) obj[k]={has:!!(chk&&chk.checked), amount: (amt&&amt.value)||''};}); return obj;})()
    };
    localStorage.setItem('alpha_line2_pdf_draft', JSON.stringify(draft));
    alert('Line 2 draft saved on this device.');
  });
  document.getElementById('l2-loadDraft').addEventListener('click', ()=>{
    const raw = localStorage.getItem('alpha_line2_pdf_draft');
    if (!raw) return alert('No draft found.');
    const {base={},fam=[],calls=[],banks=[],assets={}} = JSON.parse(raw);
    const form=document.getElementById('line2Form');
    for (const [k,v] of Object.entries(base)){ const el=form.elements[k]; if(!el) continue; el.value=v; }
    // rebuild tables
    const fb=document.querySelector('#l2-family tbody'); fb.innerHTML=''; fam.forEach(()=>addRow('l2-family'));
    const cb=document.querySelector('#l2-calls tbody'); cb.innerHTML=''; calls.forEach(()=>addRow('l2-calls'));
    const bb=document.querySelector('#l2-banks tbody'); bb.innerHTML=''; banks.forEach(()=>addRow('l2-banks'));
    // restore cell values
    function fillRows(id, rows){ const tb=document.querySelectorAll(`#${id} tbody tr`);
      rows.forEach((row,i)=>{ const inputs = tb[i].querySelectorAll('input,select,textarea'); Object.values(row).forEach((v,idx)=>{ if(inputs[idx]) inputs[idx].value=v; }); });
    }
    fillRows('l2-family',fam); fillRows('l2-calls',calls); fillRows('l2-banks',banks);
    // assets
    Object.entries(assets).forEach(([k,v])=>{ const chk=document.getElementById('asset_'+k); const amt=document.getElementById('asset_'+k+'_amt'); if(chk) chk.checked=!!v.has; if(amt) amt.value=v.amount||''; });
  });
})();

/* ========= Line 2: Download PDF ========= */
document.getElementById('l2-downloadPdf').addEventListener('click', async ()=>{
  const nameEl = document.querySelector('#line2Form input[name="clientName"]');
  if (!nameEl || !nameEl.value.trim()) { alert('Please enter Client Name first.'); return; }
  const { jsPDF } = window.jspdf;
  const target = document.querySelector('#line2'); // capture only the Line 2 section

  // temporarily show the panel (in case user is on Line 1 tab)
  const wasHidden = target.classList.contains('hidden');
  if (wasHidden) target.classList.remove('hidden');

  // white background for clean PDF
  const originalBg = document.body.style.background;
  document.body.style.background = '#ffffff';

  const canvas = await html2canvas(target, { scale: 2, backgroundColor: '#ffffff' });
  const imgData = canvas.toDataURL('image/png');

  // restore
  document.body.style.background = originalBg;
  if (wasHidden) target.classList.add('hidden');

  const pdf = new jsPDF('p','mm','a4');
  const W  = pdf.internal.pageSize.getWidth();
  const H  = pdf.internal.pageSize.getHeight();
  const imgW = W;
  const imgH = canvas.height * imgW / canvas.width;

  let left = imgH, pos = 0;
  pdf.addImage(imgData, 'PNG', 0, pos, imgW, imgH);
  left -= H;
  while (left > 0){
    pos = left - imgH;
    pdf.addPage();
    pdf.addImage(imgData, 'PNG', 0, pos, imgW, imgH);
    left -= H;
  }
  const ts = new Date();
  const fname = `Line2_${nameEl.value.trim().replace(/\s+/g,'_')}_${ts.getFullYear()}-${String(ts.getMonth()+1).padStart(2,'0')}-${String(ts.getDate()).padStart(2,'0')}.pdf`;
  pdf.save(fname);
});
</script>
</body>
</html>
